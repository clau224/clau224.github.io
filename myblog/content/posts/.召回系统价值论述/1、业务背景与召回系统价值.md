

在加入LineMan之后，我负责的是多路召回这部分。多路召回是干啥的呢？简单来说，当我们打开类似美团的外卖app，在无关键字检索的情况下，首页需要展示推荐餐厅。那么，都展示哪些餐厅呢，凭什么把它们展示出来呢？这就涉及到多路召回的逻辑了。

同样的，本篇我依旧借助一些核心问题，来一步步加深我对多路召回的理解。如果能给各位带来新的启发，荣幸之至。



[TOC]

# 1、业务背景与召回系统价值

开始的开始，我依旧想从业务价值切入。尤其是在转向偏C端方向后，我更加认为技术是服务于业务的。

那么，在外卖首页推荐场景中，关于业务价值我有三问：

- 外卖首页推荐场景下，召回时的业务痛点有哪些？
- 多路召回是怎么工作的？如何解决这些痛点的？
- 解决了痛点，是否真的产生了价值呢？如何去评估？



## 1.1、外卖首页推荐的业务痛点

如引言所述，几乎所有购物类APP都存在首页推荐。但是，在外卖场景中有一个比较鲜明的特殊性——决策周期短。

相较于传统电商购物，用户在浏览外卖首页时，决策周期往往极短。想象一下，忙碌了一上午，中午饥肠辘辘打开外卖 APP，咱们肯定希望能在短短几分钟内就选定心仪的餐食下单，而不是花费大量时间筛选。

外卖场景下，用户的需求多种多样。有的用户追求便捷性，希望能快速找到距离近、配送快的商家；有的用户看重性价比，对优惠力度大、价格实惠的商品更为关注；还有的用户执着于口味偏好，钟情于特定菜系或风味的美食。

你所在的城市，外卖商家成千上万。面对如此海量的商家和商品信息，怎么快速且准确的猜中你的喜好呢？



## 1.2、多路召回系统在其中的作用

关于上面的业务痛点，有一个稍专业些的词，叫“信息过载”。这正是多路召回系统能够解决的问题。它如同一个智能 “筛选器”，能够从平台庞大的商家与商品库中，依据不同维度的规则与算法，快速筛选出符合用户潜在需求的候选商家或餐品。

比如拿1.1中的需求举例，多路召回能同时召回多个候选集合，它的每一路都对应不同的商业逻辑：

- 可以根据用户当下所处的地理位置，快速筛选出周边可配送的优质商家；
- 可以分析用户过往点餐记录等行为，比较爱吃往往会一直爱吃下去；
- 甚至我们可以根据用户画像，找出口味相近的人群，看看他们都喜欢吃什么。

上面的召回逻辑很容易理解，非常符合我们的订餐偏好。那么，当我们的系统在引入多路召回后，怎么评判它是否真的产生了正向效果呢？



## 1.3、外卖首页推荐的核心目标

首先声明一点，目前我所在的后端团队更偏向于底层，首要目标更倾向于服务稳定性保障，商业化目标更多的是算法团队来主导。

尽管如此，我希望能看到背后的业务逻辑和价值。开发的代码赚更多的钱，或产生更大的用户粘性，是更有成就感的一件事。

那么，观察业务效果是关键。关注了下业界核心的业务指标，有以下几种：

- 相关性指标：我认为这类指标最关键。试想，召回的都是不相关餐厅，那么再怎么排序都没鸟用。
  - 点击率（CTR）：召回候选集中被用户点击的比例（点击数 / 召回展示数）。若某路召回的 CTR 显著低于平均水平，说明该路径的相关性较差（如 “基于用户 30 天前行为的召回” 可能因需求变化而失效）。
  - 加购率/下单率（CVR）：召回商品被加入购物车或最终下单的比例。相比 CTR，我认为CVR 更能反映召回商品的 “深层相关性”（比如用户点击后发现价格不符、距离太远，可能 CTR 高但 CVR 低）。
- 多样性指标：衡量召回的丰富度，避免同质化。毕竟把满满一页的川菜，赶在你上火的时候推给你，不太行不是？
  - 品类多样些：召回候选集中，不同品类的占比分布（比如前 5 大品类占比是否超过 80%）。可用 “信息熵” 量化：熵值越高，品类分布越均匀，多样性越好。
  - 召回多样性：最终进入排序阶段的商品中，来自不同召回路径的比例（如 “基于历史行为”“热门推荐”“新品推荐” 等路径的贡献是否均衡）。若某一路径占比超过 90%，说明其他路径未发挥作用，多样性不足。
- 业务规则指标：多路召回需服务于平台的商业目标（如扶持新商家、提升高毛利商品转化等），毕竟还是要赚钱的呢！
  - 新商家召回率：平台新增商品 / 商家中，被多路召回策略命中的比例。若新商家长期无法被召回，可能导致平台生态僵化。
  - 高价值商品召回占比：在召回候的选集中，高客单价、高毛利、高评分商品的占比。（过高过低都不好，高档餐厅不是人人能去的起）

以上，是我认为能较好衡量且易分析实现的商业指标。



在分析完多路召回的业务价值后，来做下业界调研，看看多路召回系统在设计时需要考虑哪些核心原则。





# 2、多路召回系统的核心设计原则

## 2.1、多样性原则

用户需求的多样性决定了多路召回系统必须具备丰富的召回维度。

目前我负责的召回阶段，能力是单一的，只有通过ES进行召回（核心是基于距离），支持促销查询等场景，但都是高度依赖固定过滤条件的场景。

那么，假如让我来完善召回逻辑的多样性，参考业界还有以下做法：

1. 实时场景召回：捕捉用户当下即时需求，适配实时搜索、场景突变等动态场景，如雨天优先召回热饮商家。
2. 历史行为召回：满足用户 “复购” 或 “相似需求”，适用于老用户、有明确消费记录的场景。
3. 时效性热门召回：满足 “从众” 需求（避免踩坑），新用户、无明确偏好用户、时段场景。
4. 协同过滤召回：基于用户或商品相似度挖掘隐性关联，适合行为丰富但需求模糊的用户，如为买美式咖啡的人推荐全麦三明治。

以上，通过覆盖这些不同维度的需求，系统确保推荐结果丰富多样，避免用户总是看到千篇一律的内容，从而提升用户体验。

各路召回策略的具体实现，可以参考下翻到第三章。



## 2.2、效率性原则





## 2.3、可扩展性原则

外卖业务处于不断发展变化之中，新的商家持续入驻，用户需求也在不断演变，新的消费场景和流行趋势层出不穷。多路召回系统必须具备良好的可扩展性，以适应这些变化。这意味着系统架构能够方便地支持新增召回策略。比如，随着外卖平台开始涉足生鲜配送领域，为了满足用户对生鲜商品的需求，系统可以快速添加基于生鲜品类特点的召回策略，如优先召回提供新鲜直采、当日达生鲜服务的商家。同时，对于已有的召回策略，也能根据业务发展进行灵活调整与优化，确保系统始终能精准匹配不断变化的业务需求。



## 2.4、数据驱动原则

用户行为数据、商家数据等海量数据是多路召回系统的 “燃料”。通过对用户行为数据的深入分析，系统能够洞察用户的真实需求与偏好。例如，通过分析用户在 APP 上的浏览轨迹、点击行为、下单记录等，系统可以精准勾勒出用户的兴趣画像，了解用户对不同菜系、价格区间、商家品牌的喜好程度。对于商家数据，包括商家的菜品信息、评分评价、配送范围、营业状态等，系统可以从中挖掘出商家的优势与特点。基于这些数据洞察，系统能够对召回策略进行持续优化。比如，如果发现某一区域内用户对某类新菜品的关注度和下单率持续上升，系统可以相应地调整召回策略，增加这类菜品相关商家的召回权重，从而实现更精准、高效的推荐。



# 3、外卖首页推荐场景下的召回策略设计

1. 基于用户历史行为的召回

- 近期浏览 / 下单商家召回：优先召回用户近期有过交互的商家

- 品类偏好召回：根据用户历史下单品类，召回同品类优质商家

- 价格带偏好召回：匹配用户常消费的价格区间商家

1. 基于实时场景的召回

- 地理位置召回：结合用户当前位置，优先召回距离近、配送快的商家

- 时段召回：如早餐时段重点召回早餐类商家，午餐时段侧重快餐类商家

- 天气场景召回：如雨天增加雨衣、热饮相关商品 / 商家的召回权重

1. 基于热门与优质内容的召回

- 平台热门商家召回：召回近期订单量高、评分好的热门商家

- 新店 / 活动商家召回：针对新入驻或有优惠活动的商家进行召回，提升平台新鲜感

- 优质口碑召回：根据用户评价、商家评分等维度筛选出的高口碑商家

1. 基于协同过滤的召回

- 相似用户偏好召回：参考与目标用户行为相似的用户的下单商家进行召回

- 商家关联召回：如用户下单过某汉堡店，可召回搭配度高的饮品店



# 4、多路召回系统的工程实现要点

1. 数据层：用户行为数据、商家数据、商品数据的采集与存储

- 实时数据处理：采用流处理框架（如 Flink）处理用户实时行为

- 离线数据处理：通过批处理任务（如 Spark）生成用户画像、商家特征等

1. 召回层：各召回策略的具体实现与调度

- 召回策略的并行计算：确保多策略同时运行，提升召回效率

- 召回结果的初步过滤：去除无效商家（如已打烊、超出配送范围等）

1. 融合层：多源召回结果的整合与排序

- 权重分配：根据不同召回策略的效果（如点击率、转化率）动态调整权重

- 去重处理：避免同一商家在推荐列表中重复出现

1. 服务层：系统的接口设计与性能优化

- 接口响应速度优化：通过缓存、索引等方式提升接口性能

- 服务高可用：采用集群部署、熔断降级等策略保障系统稳定运行



# 5、系统效果评估与迭代

1. 评估指标：点击率（CTR）、下单转化率（CVR）、平均订单金额、用户留存率等

1. A/B 测试：新召回策略上线前通过 A/B 测试验证效果

1. 迭代机制：根据评估结果与业务反馈，持续优化召回策略与系统参数



# 6、外卖场景下的特殊挑战与解决方案

1. 商家动态变化：如商家营业时间、库存、配送范围等变化

- 解决方案：实时同步商家状态数据，在召回环节进行动态过滤

1. 用户需求突变：如用户临时想吃某类美食，与历史偏好差异较大

- 解决方案：结合用户实时搜索、浏览行为，增强实时场景召回的权重

1. 冷启动问题：新用户、新商家的召回

- 新用户：基于用户注册信息（如地理位置、口味偏好选择）、热门内容进行召回

- 新商家：通过新店扶持政策，在特定时段增加其召回权重



# 7、未来展望

1. 引入更智能的召回策略：如基于深度学习的召回模型

1. 提升系统的个性化程度：更精准地捕捉用户的细分需求

1. 结合业务生态拓展召回维度：如融入用户社交关系、跨平台行为等数据